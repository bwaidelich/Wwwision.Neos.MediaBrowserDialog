window.addEventListener("DOMContentLoaded",()=>{async function e(e){const t=e.dataset.asset,s=t.length>0,a=e.querySelector("[data-asset-field]");if(a&&(a.value=s?t:""),e.querySelectorAll("[data-asset-hide-if-set]").forEach(e=>e.style.display=s?"none":""),e.querySelectorAll("[data-asset-hide-if-missing]").forEach(e=>e.style.display=s?"":"none"),!s)return;const n=e.querySelector("img[data-asset-preview-image]"),i=e.querySelector("[data-asset-preview-label]");if(n||i){n&&n.setAttribute("src",""),i&&(i.textContent="");const{label:e,previewUrl:s}=await async function(e){const t=await fetch(`/neos/service/assets/${e}`),s=await t.text(),a=(new DOMParser).parseFromString(s,"text/html");return{label:a.querySelector("label.asset-label").textContent,previewUrl:a.querySelector('a[rel="preview"]').getAttribute("href")}}(t);n&&n.setAttribute("src",s),i&&(i.textContent=e)}}document.querySelectorAll("[data-asset]").forEach(async t=>{!function(t){t.querySelectorAll("[data-asset-browse]").forEach(s=>{s.addEventListener("click",async s=>{s.preventDefault();const a="assetConstraintsAssetSources"in t.dataset?t.dataset.assetConstraintsAssetSources.split(","):[],n="assetConstraintsMediaTypes"in t.dataset?t.dataset.assetConstraintsMediaTypes.split(","):[],i=await async function(e,t,s){return new Promise(a=>{const n=s?new URL("/neos/media/browser/images/edit.html?asset="+s,window.location.origin):new URL("/neos/media/browser/assets/index.html",window.location.origin);e.map(e=>n.searchParams.append("constraints[assetSources][]",e.trim())),t.map(e=>n.searchParams.append("constraints[mediaTypes][]",e.trim()));const i=window.open("","","width=1280,height=720,menubar=no,location=no,addressbar=no");i.document.write('<html lang="en"><head><title>Media</title>'),i.document.write("<script>window.NeosMediaBrowserCallbacks={assetChosen:assetIdentifier => { this.dispatchEvent(new CustomEvent('assetChosen', { detail: assetIdentifier })); window.close(); }};<\/script>"),i.document.write('<body style="margin:0;">'),i.document.write('<iframe name="neos-media-selection-screen" src="'+n.toString()+'" style="position:absolute;width:100%;height:100%;border-width:0;background-color:#222"/>'),i.document.write("</body></html>"),i.document.close(),i.addEventListener("assetChosen",e=>a(e.detail)),i.addEventListener("beforeunload",e=>a(null))})}(a,n,t.dataset.asset);i&&(t.dataset.asset=i,t.dispatchEvent(new CustomEvent("assetChosen",{detail:i})),await e(t))})}),t.querySelectorAll("[data-asset-replace]").forEach(s=>{s.addEventListener("click",async s=>{s.preventDefault(),t.dataset.asset="",t.dispatchEvent(new CustomEvent("assetRemoved")),await e(t)})})}(t),await e(t,t.dataset.asset)})});
